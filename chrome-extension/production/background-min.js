function contains(e,t){for(var n=0;n<e.length;n++){if(e[n]===t){return true}}return false}function openInputWindow(){chrome.windows.create({url:"https://handsfreechrome.com/input.html",height:300,width:400,left:screen.width-400,top:-10},function(e){inputWindowId=e.id})}function executeMessage(e,t){if(last_message&&last_message.startsWith("keep")&&last_message.endsWith(e)){return}if(last_message==="Newtown"&&e==="new tab"){return}if(!parseInt(e)&&e===last_message&&(new Date).getTime()-time_of_last_request<1e3){console.log("noticed time");return}last_message=e;if(!t&&e.endsWith(".com")){e=e.slice(0,-4)}if(!t&&!e.startsWith("go to")){time_of_last_request=(new Date).getTime()}if(!t){console.log("executing: "+e);chrome.windows.getAll({populate:true},function(t){t.forEach(function(t){if(e==="quit"||e==="exit"){chrome.windows.remove(t.id);return}if(e==="done"||e==="Don"){chrome.windows.remove(inputWindowId);return}if(t.tabs[0].url==="https://handsfreechrome.com/input.html"){return}if(e==="full screen"){if(t.state!=="fullscreen"){chrome.windows.update(t.id,{state:"fullscreen"})}else if(t.state==="fullscreen"){chrome.windows.update(t.id,{state:"maximized"})}return}if(e==="minimize"){chrome.windows.update(t.id,{state:"minimized"});return}if(e==="new tab"||e==="Newtown"){chrome.tabs.create({windowId:t.id});return}if(e==="switch"){now=false;chrome.tabs.query({windowId:t.id},function(e){for(var t=0;t<e.length;t++){if(now){chrome.tabs.update(e[t].id,{active:true});break}if(e[t].active){now=true;if(t==e.length-1){chrome.tabs.update(e[0].id,{active:true});break}}}})}chrome.tabs.query({active:true,windowId:t.id},function(t){var n=t[0];var r=n.url;var i=n.id;if(e==="close tab"){chrome.tabs.remove(i);return}chrome.tabs.sendMessage(i,e)})})})}else{chrome.windows.getAll({populate:true},function(t){t.forEach(function(t){if(t.tabs[0].url==="https://handsfreechrome.com/input.html"){return}chrome.tabs.query({active:true,windowId:t.id},function(t){var n=t[0];var r=n.url;var i=n.id;chrome.tabs.sendMessage(i,e)})})})}}var inputWindowId=null;var time_of_last_request=0;var dictation_mode=false;var last_message=null;if(typeof String.prototype.startsWith!=="function"){String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}}if(typeof String.prototype.endsWith!=="function"){String.prototype.endsWith=function(e){return this.slice(-e.length)===e}}chrome.browserAction.onClicked.addListener(function(){openInputWindow()});chrome.runtime.onMessageExternal.addListener(function(e,t,n){if(t.url!=="https://www.handsfreechrome.com/input.html"&&t.url!=="https://handsfreechrome.com/input.html"){alert("Nevermind, bad URL from message sender.");console.log("Nevermind, bad URL from message sender.");console.log("URL: "+t.url);return}if(!e.message){return}if(e.message==="CHROME_DICTATION_STOP"||e.message==="CHROME_DICTATION_SUBMIT"){dictation_mode=false}if(!dictation_mode){console.log("called as command: "+e.message);executeMessage(e.message,false)}else{console.log("called as dictation: "+e.message);executeMessage(e.message,true)}});chrome.runtime.onMessage.addListener(function(e,t,n){if(t.tab){if(t.tab.url!=="https://www.handsfreechrome.com"){if(e.greeting.dictModeOn){console.log("turning on dictation mode in the background window");dictation_mode=true;chrome.windows.get(inputWindowId,{populate:true},function(e){chrome.tabs.query({active:true,windowId:e.id},function(e){var t=e[0];var n=t.url;var r=t.id;console.log("Active: "+n+" Id: "+r);chrome.tabs.sendMessage(r,{dictModeOn:true})})})}else if(e.greeting==="TOGGLE_EXTENSION_ON_OFF"){var r=true;chrome.windows.getAll({populate:true},function(e){e.forEach(function(e){if(e.tabs[0].url==="https://handsfreechrome.com/input.html"){console.log("bang");chrome.windows.remove(e.id);r=false}});if(r){openInputWindow()}})}}}})